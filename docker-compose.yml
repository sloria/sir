api:
  restart: always
  build: .
  links:
    - redis
  env_file: .env
  environment:
    - REDIS_HOST=redis
    - REDIS_PORT=6379
    - NODE_ENV=production
    - APIHOST='sir.sloria.io'
  volumes:
    - /usr/src/app
  expose:
    - "5000"
  command: /usr/local/bin/gunicorn "api.app:create_app()" -w 4 --bind 0.0.0.0:5000 --worker-class aiohttp.worker.GunicornWebWorker --chdir=/usr/src/app

redis:
  restart: always
  image: redis:3.0

nginx:
  restart: always
  build: ./compose/nginx
  links:
    - api
  ports:
    - "80:80"
